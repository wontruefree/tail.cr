{"repository_name":"github.com/j8r/tail.cr","body":"# Tail.cr\n\n[![Build Status](https://cloud.drone.io/api/badges/j8r/tail.cr/status.svg)](https://cloud.drone.io/j8r/tail.cr)\n[![ISC](https://img.shields.io/badge/License-ISC-blue.svg?style=flat-square)](https://en.wikipedia.org/wiki/ISC_license)\n\nTailing library for Crystal - get and/or follow the end of a file/IO\n\n[Inotify.cr](https://github.com/petoem/inotify.cr) library is used to watch files.\n\n## Installation\n\nAdd the dependency to your `shard.yml`:\n\n```yaml\ndependencies:\n  exec:\n    github: j8r/tail.cr\n```\n\n## Documentation\n\nhttps://j8r.github.io/tail.cr\n\n## Examples\n\n```crystal\nrequire \"tail\"\n\nTail::File.open \"file\", &.follow do |str|\n  print str\nend\n\nTail::File.open \"file\", &.last_lines\n```\n\n## License                                                                                                 \n\nCopyright (c) 2018-2019 Julien Reichardt - ISC License\n","program":{"html_id":"github.com/j8r/tail.cr/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"github.com/j8r/tail.cr","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/j8r/tail.cr/Tail","path":"Tail.html","kind":"module","full_name":"Tail","name":"Tail","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"tail.cr","line_number":3,"url":"https://github.com/j8r/tail.cr/blob/1486af5b48d2f2bc3fa559056340e6261f26cf49/src/tail.cr"}],"repository_name":"github.com/j8r/tail.cr","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[{"id":"follow(io:IO,delay=0.1,&:String->)-class-method","html_id":"follow(io:IO,delay=0.1,&amp;:String-&gt;)-class-method","name":"follow","doc":"Follows the new appended bytes of an `IO`.","summary":"<p>Follows the new appended bytes of an <code>IO</code>.</p>","abstract":false,"args":[{"name":"io","doc":null,"default_value":"","external_name":"io","restriction":"IO"},{"name":"delay","doc":null,"default_value":"0.1","external_name":"delay","restriction":""}],"args_string":"(io : IO, delay = <span class=\"n\">0.1</span>, & : String -> )","source_link":"https://github.com/j8r/tail.cr/blob/1486af5b48d2f2bc3fa559056340e6261f26cf49/src/tail.cr#L5","def":{"name":"follow","args":[{"name":"io","doc":null,"default_value":"","external_name":"io","restriction":"IO"},{"name":"delay","doc":null,"default_value":"0.1","external_name":"delay","restriction":""}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"","doc":null,"default_value":"","external_name":"","restriction":"(String -> )"},"return_type":"","visibility":"Public","body":"loop do\n  if !(content = io.gets_to_end).empty?\n    yield content\n  end\n  sleep(delay)\nend"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/j8r/tail.cr/Tail/File","path":"Tail/File.html","kind":"struct","full_name":"Tail::File","name":"File","abstract":false,"superclass":{"html_id":"github.com/j8r/tail.cr/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"github.com/j8r/tail.cr/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"github.com/j8r/tail.cr/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"github.com/j8r/tail.cr/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"tail.cr","line_number":14,"url":"https://github.com/j8r/tail.cr/blob/1486af5b48d2f2bc3fa559056340e6261f26cf49/src/tail.cr"}],"repository_name":"github.com/j8r/tail.cr","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/j8r/tail.cr/Tail","kind":"module","full_name":"Tail","name":"Tail"},"doc":null,"summary":null,"class_methods":[{"id":"open(file:Path|String,&:File->)-class-method","html_id":"open(file:Path|String,&amp;:File-&gt;)-class-method","name":"open","doc":"Open a file to tail into it.","summary":"<p>Open a file to tail into it.</p>","abstract":false,"args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"Path | String"}],"args_string":"(file : Path | String, & : File -> )","source_link":"https://github.com/j8r/tail.cr/blob/1486af5b48d2f2bc3fa559056340e6261f26cf49/src/tail.cr#L20","def":{"name":"open","args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"Path | String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"","doc":null,"default_value":"","external_name":"","restriction":"(File -> )"},"return_type":"","visibility":"Public","body":"::File.open(file) do |fd|\n  yield File.new(fd)\nend"}}],"constructors":[{"id":"new(file:::File)-class-method","html_id":"new(file:::File)-class-method","name":"new","doc":"Tail a file IO.","summary":"<p>Tail a file IO.</p>","abstract":false,"args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"::File"}],"args_string":"(file : ::File)","source_link":"https://github.com/j8r/tail.cr/blob/1486af5b48d2f2bc3fa559056340e6261f26cf49/src/tail.cr#L16","def":{"name":"new","args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"::File"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(file)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"follow(lines=0,line_size=1024,delay=0.1,&block:String->UNDERSCORE)-instance-method","html_id":"follow(lines=0,line_size=1024,delay=0.1,&amp;block:String-&gt;UNDERSCORE)-instance-method","name":"follow","doc":"Follows the end of a file.\n\n```\nTail::File.open \"file\", &.follow do |str|\n  print str\nend\n```","summary":"<p>Follows the end of a file.</p>","abstract":false,"args":[{"name":"lines","doc":null,"default_value":"0","external_name":"lines","restriction":""},{"name":"line_size","doc":null,"default_value":"1024","external_name":"line_size","restriction":""},{"name":"delay","doc":null,"default_value":"0.1","external_name":"delay","restriction":""}],"args_string":"(lines = <span class=\"n\">0</span>, line_size = <span class=\"n\">1024</span>, delay = <span class=\"n\">0.1</span>, &block : String -> UNDERSCORE)","source_link":"https://github.com/j8r/tail.cr/blob/1486af5b48d2f2bc3fa559056340e6261f26cf49/src/tail.cr#L63","def":{"name":"follow","args":[{"name":"lines","doc":null,"default_value":"0","external_name":"lines","restriction":""},{"name":"line_size","doc":null,"default_value":"1024","external_name":"line_size","restriction":""},{"name":"delay","doc":null,"default_value":"0.1","external_name":"delay","restriction":""}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(String -> _)"},"return_type":"","visibility":"Public","body":"yield_last_lines(lines, line_size, &block)\nTail.follow(@file, delay, &block)\n"}},{"id":"last_lines(lines=10,line_size=1024):Array(String)-instance-method","html_id":"last_lines(lines=10,line_size=1024):Array(String)-instance-method","name":"last_lines","doc":"Gets the last n `lines`.\n`line_size` is used to extract the end of the file, and then calculate the trailing lines.\n\n```\nTail::File.open \"file\", &.last_lines\n```","summary":"<p>Gets the last n <code>lines</code>.</p>","abstract":false,"args":[{"name":"lines","doc":null,"default_value":"10","external_name":"lines","restriction":""},{"name":"line_size","doc":null,"default_value":"1024","external_name":"line_size","restriction":""}],"args_string":"(lines = <span class=\"n\">10</span>, line_size = <span class=\"n\">1024</span>) : Array(String)","source_link":"https://github.com/j8r/tail.cr/blob/1486af5b48d2f2bc3fa559056340e6261f26cf49/src/tail.cr#L32","def":{"name":"last_lines","args":[{"name":"lines","doc":null,"default_value":"10","external_name":"lines","restriction":""},{"name":"line_size","doc":null,"default_value":"1024","external_name":"line_size","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Array(String)","visibility":"Public","body":"if (size = @file.size) > 0\n  offset = lines * line_size\n  @file.seek(0 &- (size < offset ? size : offset), IO::Seek::End)\n  end_lines = @file.gets_to_end.lines\n  if end_lines.size > lines\n    end_lines[(end_lines.size - lines)..-1]\n  else\n    end_lines\n  end\nelse\n  Array(String).new\nend"}},{"id":"watch(lines=0,line_size=1024,&block:String->UNDERSCORE)-instance-method","html_id":"watch(lines=0,line_size=1024,&amp;block:String-&gt;UNDERSCORE)-instance-method","name":"watch","doc":"Watchs for newly added bytes to the file by using inotify.","summary":"<p>Watchs for newly added bytes to the file by using inotify.</p>","abstract":false,"args":[{"name":"lines","doc":null,"default_value":"0","external_name":"lines","restriction":""},{"name":"line_size","doc":null,"default_value":"1024","external_name":"line_size","restriction":""}],"args_string":"(lines = <span class=\"n\">0</span>, line_size = <span class=\"n\">1024</span>, &block : String -> UNDERSCORE)","source_link":"https://github.com/j8r/tail.cr/blob/1486af5b48d2f2bc3fa559056340e6261f26cf49/src/tail.cr#L69","def":{"name":"watch","args":[{"name":"lines","doc":null,"default_value":"0","external_name":"lines","restriction":""},{"name":"line_size","doc":null,"default_value":"1024","external_name":"line_size","restriction":""}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(String -> _)"},"return_type":"","visibility":"Public","body":"yield_last_lines(lines, line_size, &block)\nInotify.watch(@file.path) do\n  if !(content = @file.gets_to_end).empty?\n    block.call(content)\n  end\nend\n"}}],"macros":[],"types":[]}]}]}}